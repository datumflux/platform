개발언어와 상관없이 백엔드(서버) 프로그램의 성능을 결정하는 가장 큰 요소는 바로 메시지를 관리하는 방식에 있습니다. 
클라이언트 프로그램과 다르게 백엔드(서버) 프로그램은 수많은 클라이언트에서 전달되는 메시지를 빠르게 처리하면서 안정적으로 관리해야 하는 역할을 가지고 있습니다.

서버의 역할에 문제가 있다라는 의미는 *메시지의 처리가 효과적이지 않다* 라는 의미를 가지고 있습니다. 
서버 개발을 담당하는 개발자는 메시지의 효과적인 처리를 위해 다양한 기술을 배우고 사용하려 하지만, 늘 어려움을 접하게 됩니다.

여기에서 설명하는 다양한 문제는 STAGE:플랫폼이 문제를 해결하는 방법이기도 하면서 서버를 개발하는데 필요한 처리이기도 합니다.

> ## 일반적으로 메시지는

1. 외부에서 전달되는 메시지: TCP 또는 UDP를 통해 요청되는 네트워크 메시지
2. 프로세서 간 통신을 통해 전달 되는 메시지(분산 처리를 위해 사용)
3. 프로세서 내에서 쓰레드의 메시지

로 분류가 됩니다.
 
> ## 첫번째 
#### 외부 메시지는 이후 설명되는 다른 메시지에 비해 발생 빈도의 예측과 통제가 어려워 서비스의 성능에 가장 많은 영향을 주게 됩니다.
 
   통제가 불가능한 이유는 데이터의 발생이 사용자 또는 외부적인 요소에 의해 결정되기 때문입니다.
   이러한 상황을 어떻게 통제 하느냐에 따라 서비스의 안정성이 결정되는 요소가 되기도 합니다.
 
   > ### STAGE:플랫폼은 외부적인 데이터의 통제를 위해 다음과 같은 기능을 지원합니다.
   
   1. 외부에서 발생되는 과도한 메시지 발생을 제한하는 입력(INPUT) 처리
   2. 특정 연결(클라이언트)이 메시지 처리를 독점하지 못하도록 하는 메시지 분배 처리
   3. 쓰레드(worker)와 프로세서(prefork) 분배를 통한 일정한 처리 속도의 유지
   4. 처리 결과를 일정한 주기로 전송하고 처리하는 메시지 전달 정책
   5. 비 정상 소켓과 좀비 소켓을 관리하는 소켓 관리 방식
   
   문제를 해결하기 위해, *입력과 출력을 일정하게 유지하면서 모든 연결(클라이언트)이 메시지를 처리할 수 있도록 유지* 하는 것입니다. 
   > 서버가 성능과 안정성을 유지하는 가장 중요한것은 일정한 간격의 메시지 입출력 입니다. (네트워크가 빠르다는 의미는 많은 양의 데이터가 짧은 시간에 입력될 수 있음을 의미합니다.) 
 
> ## 두번째
#### 메시지는 프로세서간에 분산된 처리를 하기 위한 메시지로 처리 지연이 발생되는 경우 서비스의 멈춤현상과 같은 문제가 발생됩니다.
 
   *멈춤현상* 은 프로세서의 처리 한계 이상을 요청하면서 발생되는 문제로, *발생이 시작되면 입력 메시지의 수가 한계 수치 이하로 낮아지기 전까지 지속적인 서비스 불안정이 발생* 되는 특징을 보입니다. 주로 첫번째 요소가 원인이 됩니다. (출퇴근 교통상황을 생각하시면 됩니다.)
 
   ### 주로 발생되는 상황은
   
   1. 무결성 처리가 필요한 상황에 동기화로 인한 처리 지연
   2. 데이터베이스와 같은 외부적인 지연으로 인한 상황
    
   이러한 현상은 데이터베이스로 부터 대량의 데이터를 가져와야 하는 상황이나 여려명의 게임 플레이 후에 판정을 하는 경우와 같은 상황에 주로 발생이 됩니다.
   CCU가 늘어나면서 발생이 시작이 되는 특징으로 인해 서버당 한계를 뜻하기도 합니다.
   
   정확하게는 데이터에 대한 최적화와 처리량에 대한 로드 벨런싱이 되지 않아 발생되는 상황으로, 문제해결을 하지못하고 하드웨어로 문제를 보완하기도 합니다.
   두번째 문제가 가장 복잡한 문제이면서, 기술적으로도 고 난이도 성향과 메시지 처리구조를 재 구성해야 해결이 가능한 상황도 있습니다.
   
   최근 이러한 문제를 해결하기위해 개발 초기부터 메시지큐와 캐싱서버등이 사용되기도 합니다.  
   > ### STAGE:플랫폼은 이러한 처리를 효과적으로 하기 위해 다음의 기능을 지원합니다.
   
   1. 메시지의 효과적인 분배를 위한 라우팅 STAGE 지원
   2. 동시 처리 통제를 위한 티켓 STAGE 지원
   3. 처리함수와 메시지를 외부 프로세서에서 실행할 수 있는 원격 실행 지원
   
   문제를 해결하기 위한 가장 중요한 요소는 *로드 벨런싱과 일정한 처리량 관리* 입니다.
   > 대량 메시지는 항상 발생될수 있고, 처리되어야 하는 메시지임을 인지하고 제한된 자원을 관리하기 위한 신호등을 세우고 신호 체계를 조정하는 것입니다.
 
> ## 마지막
#### 쓰레드간의 메시지 전달 정책입니다.
 
   효과적으로 처리를 분산하기 위해서 다양한 기법을 사용하기도 하지만, 잘못 처리된 쓰레드 관리 정책은 프로세서가 안정적으로 운영되는데 방해요소가 됩니다. <br>
   이러한 이유로 쓰레드를 보조적인 역할로만 사용하여 안정성을 유지하는 방법을 사용하기도 합니다.
   
   > 대표적으로 node.js는 비동기 I/O를 기반으로 메시지를 처리하면서, 쓰레드를 보조적인 역할로 사용하는 방식을 사용하고 있습니다.
 
   > ### STAGE:플랫폼은 쓰레드를 효과적인 처리를 위해 다음과 같은 기능을 지원합니다.
   
   1. 쓰레드간의 로드 벨런싱: 메시지의 처리가 가능한 쓰레드와 불가능한 쓰레드를 관리하여 효과적인 처리 분산을 구성
   2. CPU 수 이상으로 실행되는 쓰레드의 원할한 처리를 위한 강제 스위칭: 특정 쓰레드가 CPU를 독점하지 못하도록 제한
   3. 특정 메시지 또는 메시지 생산자가 쓰레드를 독점하지 못하도록 하는 메시지 분배 정책
   4. 공유되는 메모리의 안정적인 접근을 위한 스냅샷 
   
   문제의 가장 중요한 요소는 *특정 쓰레드와 메시지가 CPU를 독점하지 못하도록 관리* 하는 것입니다. 
 
**STAGE:플랫폼의 다양한 처리 기술은 스크립트를 통해 자연스럽게 사용되고 있습니다.**
